---
phase: 06-seo-sitemap
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/download/page.tsx
  - src/app/sitemap.ts
  - src/components/LayoutContent/LayoutContent.tsx
autonomous: true
requirements:
  - SEO-01
  - SEO-02
  - SEO-03
  - SEO-04

must_haves:
  truths:
    - "Sharing /download on iMessage, Slack, or social media shows a preview card with title, description, and OG image"
    - "Page has a canonical URL tag pointing to https://streetfeastapp.com/download"
    - "Page has Twitter card meta tags (summary_large_image) with title, description, and image"
    - "Page includes MobileApplication JSON-LD structured data in the HTML source"
    - "/download appears in /sitemap.xml with priority 0.8 and changeFrequency monthly"
    - "/download renders its content (not ComingSoon) when NEXT_PUBLIC_IS_LAUNCHED is unset"
  artifacts:
    - path: "src/app/download/page.tsx"
      provides: "OG, Twitter, canonical metadata + JSON-LD MobileApplication script"
      contains: "openGraph"
    - path: "src/app/sitemap.ts"
      provides: "/download entry in sitemap"
      contains: "/download"
    - path: "src/components/LayoutContent/LayoutContent.tsx"
      provides: "/download in allowedPaths launch gate"
      contains: "'/download'"
  key_links:
    - from: "src/app/download/page.tsx"
      to: "src/app/layout.tsx"
      via: "metadataBase inheritance"
      pattern: "metadataBase.*streetfeastapp"
    - from: "src/app/download/page.tsx"
      to: "public/social-media-logo.png"
      via: "OG image reference"
      pattern: "social-media-logo.png"
    - from: "src/components/LayoutContent/LayoutContent.tsx"
      to: "src/app/download/page.tsx"
      via: "allowedPaths includes /download"
      pattern: "allowedPaths.*download"
---

<objective>
Add SEO metadata (OG tags, Twitter card, canonical URL), MobileApplication JSON-LD structured data, and sitemap entry to the /download page. Also close the LayoutContent launch gate gap so /download is accessible in pre-launch production.

Purpose: Make /download discoverable by search engines, render rich preview cards when shared on social platforms, qualify for Google rich results via structured data, and ensure the page is reachable regardless of launch gate configuration.

Output: Extended metadata export in download/page.tsx, JSON-LD script in page JSX, /download entry in sitemap.ts, '/download' added to LayoutContent allowedPaths.
</objective>

<execution_context>
@/Users/jacobfinn/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jacobfinn/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-seo-sitemap/06-RESEARCH.md

<interfaces>
<!-- Key types and existing code the executor needs. Extracted from codebase. -->

From src/app/download/page.tsx (CURRENT — extend this):
```typescript
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'Download StreetFeast',
  description: 'Download the StreetFeast app to discover food trucks and street vendors near you.',
  itunes: {
    appId: '6749815073',
  },
};
```

From src/app/layout.tsx (READ-ONLY — metadataBase already set, inherited by pages):
```typescript
metadataBase: new URL('https://streetfeastapp.com'),
```

From src/app/sitemap.ts (CURRENT — add entry to this array):
```typescript
import { MetadataRoute } from 'next';
export default function sitemap(): MetadataRoute.Sitemap {
  const baseUrl = 'https://streetfeastapp.com';
  return [
    { url: baseUrl, lastModified: new Date(), changeFrequency: 'weekly', priority: 1 },
    { url: `${baseUrl}/privacy`, lastModified: new Date(), changeFrequency: 'monthly', priority: 0.5 },
    { url: `${baseUrl}/terms`, lastModified: new Date(), changeFrequency: 'monthly', priority: 0.5 },
  ];
}
```

From src/components/LayoutContent/LayoutContent.tsx (CURRENT — add '/download' to this array):
```typescript
const allowedPaths = ['/terms', '/privacy', '/delete-my-data'];
```

From src/constants/links.ts (READ-ONLY — use for optional downloadUrl in JSON-LD):
```typescript
export const APP_STORE_LINK = "https://apps.apple.com/us/app/streetfeast/id6749815073";
export const GOOGLE_PLAY_LINK = "https://play.google.com/store/apps/details?id=com.streetfeast.streetfeast";
```

Existing OG image asset: public/social-media-logo.png (1352x632)
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add OG, Twitter, canonical metadata and JSON-LD to download page</name>
  <files>src/app/download/page.tsx</files>
  <action>
Extend the existing `metadata` export in `src/app/download/page.tsx` with three new fields: `alternates`, `openGraph`, and `twitter`. Keep the existing `title`, `description`, and `itunes` fields unchanged.

**metadata additions (add after the existing `itunes` field):**

```typescript
alternates: {
  canonical: '/download',
},
openGraph: {
  title: 'Download StreetFeast',
  description: 'Discover food trucks and street vendors near you. Download the StreetFeast app.',
  url: '/download',
  siteName: 'StreetFeast',
  images: [
    {
      url: '/social-media-logo.png',
      width: 1352,
      height: 632,
      alt: 'StreetFeast - Discover Amazing Street Food',
    },
  ],
  locale: 'en_US',
  type: 'website',
},
twitter: {
  card: 'summary_large_image',
  title: 'Download StreetFeast',
  description: 'Discover food trucks and street vendors near you. Download the StreetFeast app.',
  images: ['/social-media-logo.png'],
},
```

All relative URLs (`/download`, `/social-media-logo.png`) resolve to absolute URLs automatically via `metadataBase` set in the root layout. Do NOT redefine `metadataBase` in this file.

**JSON-LD structured data (add inside the DownloadPage component JSX):**

Import `APP_STORE_LINK` and `GOOGLE_PLAY_LINK` from `@/constants/links`.

Define a `jsonLd` object INSIDE the `DownloadPage` function body (before the return statement):

```typescript
const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'MobileApplication',
  name: 'StreetFeast',
  description: 'Discover food trucks and street vendors near you.',
  applicationCategory: 'FoodApplication',
  operatingSystem: 'iOS, Android',
  url: 'https://streetfeastapp.com/download',
  downloadUrl: [APP_STORE_LINK, GOOGLE_PLAY_LINK],
  offers: {
    '@type': 'Offer',
    price: '0',
    priceCurrency: 'USD',
  },
};
```

Then add the `<script>` tag as the FIRST child inside the `<main>` element:

```tsx
<script
  type="application/ld+json"
  dangerouslySetInnerHTML={{
    __html: JSON.stringify(jsonLd).replace(/</g, '\\u003c'),
  }}
/>
```

The `.replace(/</g, '\\u003c')` is an XSS mitigation from the official Next.js JSON-LD guide.

**Do NOT:**
- Use `next/script` for JSON-LD (it is for external scripts)
- Set `openGraph.type` to anything other than `'website'` (OG protocol has no MobileApplication type)
- Add a `robots` field (the root layout's `robots` setting is inherited correctly)
- Re-define `metadataBase` (already in root layout)
  </action>
  <verify>
    <automated>cd /Users/jacobfinn/Desktop/Projects/streetfeast-website-fe && npm run lint && npm run build 2>&1 | tail -20</automated>
  </verify>
  <done>
    - metadata export includes alternates.canonical, openGraph (with title, description, url, siteName, images, locale, type), and twitter (with card, title, description, images)
    - JSON-LD script with MobileApplication schema is rendered inside the page JSX
    - Build succeeds with no errors or metadata warnings
  </done>
</task>

<task type="auto">
  <name>Task 2: Add /download to sitemap and LayoutContent allowedPaths</name>
  <files>src/app/sitemap.ts, src/components/LayoutContent/LayoutContent.tsx</files>
  <action>
**sitemap.ts — add /download entry:**

Add one new entry to the array returned by the `sitemap()` function in `src/app/sitemap.ts`. Place it after the `/terms` entry (last in the current array):

```typescript
{
  url: `${baseUrl}/download`,
  lastModified: new Date(),
  changeFrequency: 'monthly',
  priority: 0.8,
},
```

Priority `0.8` reflects download page importance (primary CTA, more important than legal pages at `0.5`, less than homepage at `1`).

**LayoutContent.tsx — add '/download' to allowedPaths:**

In `src/components/LayoutContent/LayoutContent.tsx`, change the `allowedPaths` array from:

```typescript
const allowedPaths = ['/terms', '/privacy', '/delete-my-data'];
```

to:

```typescript
const allowedPaths = ['/terms', '/privacy', '/delete-my-data', '/download'];
```

This ensures `/download` renders its content (not `<ComingSoon />`) when `NEXT_PUBLIC_IS_LAUNCHED` is not set in production. Without this fix, search engine crawlers and users who bypass the middleware redirect would see the coming soon page instead of the download page.
  </action>
  <verify>
    <automated>cd /Users/jacobfinn/Desktop/Projects/streetfeast-website-fe && npm run lint && npm run build 2>&1 | tail -20</automated>
  </verify>
  <done>
    - /sitemap.xml output includes an entry for https://streetfeastapp.com/download with priority 0.8
    - LayoutContent allowedPaths array includes '/download'
    - Build succeeds with no errors
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the full phase:

1. `npm run build` succeeds with no errors or warnings
2. `npm run lint` passes clean
3. Inspect build output: the /download route metadata should include og:title, og:description, og:image, og:url, twitter:card, link[rel=canonical], and a JSON-LD script tag
4. Inspect sitemap output: /download entry present with correct priority
5. LayoutContent includes '/download' in allowedPaths array
</verification>

<success_criteria>
1. Sharing /download URL shows a rich preview card with "Download StreetFeast" title, "Discover food trucks..." description, and social-media-logo.png image
2. Page HTML contains `<link rel="canonical" href="https://streetfeastapp.com/download" />`
3. Page HTML contains `<meta name="twitter:card" content="summary_large_image" />`
4. Page HTML contains `<script type="application/ld+json">` with MobileApplication schema
5. /sitemap.xml contains `https://streetfeastapp.com/download`
6. /download is accessible in pre-launch production (not blocked by LayoutContent)
</success_criteria>

<output>
After completion, create `.planning/phases/06-seo-sitemap/06-01-SUMMARY.md`
</output>
