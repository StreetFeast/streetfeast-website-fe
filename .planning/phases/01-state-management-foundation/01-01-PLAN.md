---
phase: 01-state-management-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/store/consentStore.ts
  - src/app/privacy/page.tsx
autonomous: true

must_haves:
  truths:
    - "User's consent choice (accept/reject/unset) persists across browser sessions via localStorage"
    - "Application can read consent state on client without hydration mismatch errors"
    - "Privacy policy reflects Google's April 2, 2026 data controller shift for reCAPTCHA"
    - "Consent store follows the same architecture as authStore (Zustand persist + isHydrated pattern)"
  artifacts:
    - path: "src/store/consentStore.ts"
      provides: "Zustand consent store with persist middleware and hydration safety"
      exports: ["useConsentStore"]
      contains: "persist"
    - path: "src/app/privacy/page.tsx"
      provides: "Updated privacy policy with reCAPTCHA data processor language"
      contains: "data processor"
  key_links:
    - from: "src/store/consentStore.ts"
      to: "localStorage"
      via: "Zustand persist middleware with 'consent-storage' key"
      pattern: "name: ['\"]consent-storage['\"]"
    - from: "src/store/consentStore.ts"
      to: "zustand/middleware"
      via: "persist import"
      pattern: "import.*persist.*from.*zustand/middleware"
    - from: "src/store/consentStore.ts"
      to: "src/store/authStore.ts"
      via: "Same architectural pattern (persist + isHydrated + onRehydrateStorage)"
      pattern: "onRehydrateStorage"
---

<objective>
Create the Zustand consent store with localStorage persistence and SSR hydration safety, and update the privacy policy for Google's reCAPTCHA data controller change.

Purpose: Establish the consent state foundation that Phase 2 (banner UI) and Phase 3 (script blocking) will consume. The store must persist consent choices across sessions and integrate cleanly with the existing Zustand patterns. The privacy policy must be legally current before the April 2, 2026 deadline.

Output: Working consent store at `src/store/consentStore.ts` and updated privacy policy at `src/app/privacy/page.tsx`.
</objective>

<execution_context>
@/Users/zachshearer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zachshearer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-state-management-foundation/01-RESEARCH.md
@src/store/authStore.ts
@src/app/privacy/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zustand consent store with localStorage persistence</name>
  <files>src/store/consentStore.ts</files>
  <action>
Create `src/store/consentStore.ts` following the exact pattern from `src/store/authStore.ts`.

**Interface:**
```typescript
interface ConsentState {
  // State
  hasConsented: boolean | null; // null = unset (no choice made), true = accepted, false = rejected
  consentTimestamp: number | null; // Date.now() when consent was given/rejected
  isHydrated: boolean; // true after localStorage rehydration completes

  // Actions
  setConsent: (consented: boolean) => void; // Sets hasConsented + consentTimestamp
  clearConsent: () => void; // Resets to null (used by footer "Cookie Preferences" link in Phase 2)
}
```

**Implementation requirements:**
- Import `create` from `zustand` and `persist` from `zustand/middleware` (same imports as authStore)
- Use `create<ConsentState>()` with explicit generic (TypeScript strict mode requires this)
- Configure persist middleware with `name: 'consent-storage'` (localStorage key)
- Implement `onRehydrateStorage` callback that sets `isHydrated = true` when rehydration completes (identical pattern to authStore lines 38-41)
- `setConsent(consented)` should set both `hasConsented` and `consentTimestamp: Date.now()`
- `clearConsent()` should reset `hasConsented: null` and `consentTimestamp: null`
- Export as named export: `export const useConsentStore`

**What NOT to do:**
- Do NOT add any component code (that is Phase 2)
- Do NOT add cookie storage -- use localStorage per user decision and research recommendation
- Do NOT add granular category support (accept/reject boolean is sufficient per requirements)
- Do NOT add `mounted` state to the store -- that is a component-level concern (see research Pattern 2)
  </action>
  <verify>
Run `npm run lint` and confirm no errors. Verify the file exists and exports `useConsentStore`. Verify it imports from `zustand` and `zustand/middleware`. Verify `onRehydrateStorage` is present. Verify `isHydrated` is in the interface and initialized to `false`. Verify `name: 'consent-storage'` is the persist key.
  </verify>
  <done>
`src/store/consentStore.ts` exists, exports `useConsentStore`, passes lint, and follows the identical persist + isHydrated + onRehydrateStorage pattern as authStore. The store has tri-state consent (null/true/false), timestamp tracking, and a clearConsent action for future re-consent functionality.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update privacy policy for reCAPTCHA data controller change</name>
  <files>src/app/privacy/page.tsx</files>
  <action>
Update `src/app/privacy/page.tsx` with three specific text changes documented in the research. Also update the `lastUpdated` date.

**Change 1 -- Section 3.3 (line 89):**
Change the Bot Detection Services bullet from:
```
<li><strong>Bot Detection Services:</strong> risk assessment scores and verification tokens from Google reCAPTCHA v3</li>
```
To:
```
<li><strong>Bot Detection Services:</strong> risk assessment scores and verification tokens from Google reCAPTCHA v3 (processed as our data processor)</li>
```

**Change 2 -- Section 6.1 (line 169):**
Change the Google reCAPTCHA bullet from:
```
<li><strong>Google (reCAPTCHA v3)</strong> — bot detection and abuse prevention (subject to Google&apos;s Privacy Policy and Terms of Service)</li>
```
To:
```
<li><strong>Google (reCAPTCHA v3)</strong> — bot detection and abuse prevention as our data processor. StreetFeast is the data controller for all data processed by reCAPTCHA.</li>
```

**Change 3 -- Section 11 (lines 304-309):**
Replace the paragraph that starts "We also utilize Google services (Maps Platform and reCAPTCHA v3)..." with:
```
We utilize Google reCAPTCHA v3 as a data processor for bot detection and fraud prevention. StreetFeast is the data controller for all information processed by reCAPTCHA. reCAPTCHA may collect hardware and software information (including device and application data) to assess interaction risk. We also use Google Maps Platform for location services, governed by Google&apos;s Privacy Policy at <a href="https://policies.google.com/privacy" target="_blank" rel="noopener noreferrer">https://policies.google.com/privacy</a>.
```

**Change 4 -- Effective date (line 17):**
Update `const lastUpdated` from `"February 18, 2026"` to today's date: `"February 19, 2026"`.

**What NOT to do:**
- Do NOT change any other sections of the privacy policy
- Do NOT change the page structure, imports, metadata, or CSS module usage
- Do NOT remove the Google Maps Platform privacy policy link (only reCAPTCHA's link changes)
- Do NOT add any cookie consent language to the privacy policy yet (that is Phase 2 scope)
  </action>
  <verify>
Run `npm run lint` and confirm no errors. Verify the three text changes are present: "data processor" appears in Section 3.3, "data controller" appears in Section 6.1, and Section 11's reCAPTCHA paragraph uses "data processor" language. Verify `lastUpdated` reflects today's date. Verify no other sections were modified by checking the file still has 19 sections and the same overall structure.
  </verify>
  <done>
Privacy policy at `src/app/privacy/page.tsx` is updated with all three reCAPTCHA data controller/processor changes matching the research recommendations. The effective date reflects today. Google Maps Platform references are preserved. No other sections were modified.
  </done>
</task>

</tasks>

<verification>
After both tasks are complete:
1. `npm run lint` passes with zero errors
2. `npm run build` completes successfully (confirms no SSR/TypeScript issues)
3. `src/store/consentStore.ts` exists and exports `useConsentStore`
4. `src/store/consentStore.ts` contains: `persist`, `onRehydrateStorage`, `isHydrated`, `consent-storage`, `hasConsented: boolean | null`
5. `src/app/privacy/page.tsx` contains "data processor" in reCAPTCHA references and updated date
</verification>

<success_criteria>
- Consent store created with tri-state (null/true/false) persistence via localStorage
- Store follows identical pattern to authStore (persist middleware, isHydrated flag, onRehydrateStorage callback)
- Privacy policy updated with Google reCAPTCHA data controller-to-processor language in Sections 3.3, 6.1, and 11
- Both files pass lint and build without errors
- No new dependencies added (Zustand 5.0.8 already installed)
</success_criteria>

<output>
After completion, create `.planning/phases/01-state-management-foundation/01-01-SUMMARY.md`
</output>
