---
phase: 03-script-blocking-form-gating
plan: 02
type: execute
wave: 1
depends_on: ["03-01"]
files_modified: ["src/components/ContactForm/ContactForm.tsx"]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Contact form only renders when hasConsented === true (explicit accept)"
    - "NoConsentAlternative renders for both null (undecided) and false (rejected) consent states"
    - "Before hydration completes, neither form nor alternative renders (returns null)"
  artifacts:
    - path: "src/components/ContactForm/ContactForm.tsx"
      provides: "Consent-branched ContactForm with strict true-only gating"
      contains: "hasConsented === true"
  key_links:
    - from: "src/components/ContactForm/ContactForm.tsx"
      to: "src/store/consentStore.ts"
      via: "useConsentStore hook"
      pattern: "hasConsented === true"
---

<objective>
Fix ContactForm consent branching to block the form when consent is undecided (null state).

Purpose: UAT test 4 revealed that the contact form renders and is fully interactive when no consent choice has been made (hasConsented === null). The current condition `hasConsented !== false` treats null as accepted. The form should only show when the user has explicitly clicked "Accept All" (hasConsented === true).

Output: Fixed ContactForm.tsx with strict consent gating.
</objective>

<execution_context>
@/Users/zachshearer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zachshearer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-script-blocking-form-gating/03-01-SUMMARY.md
@src/components/ContactForm/ContactForm.tsx
@src/store/consentStore.ts
@src/app/contact/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix ContactForm consent branching to require explicit accept</name>
  <files>src/components/ContactForm/ContactForm.tsx</files>
  <action>
In `src/components/ContactForm/ContactForm.tsx`, replace the `ContactForm` default export function's branching logic.

Current code (line 124):
```tsx
if (!isHydrated || hasConsented !== false) {
  return <ContactFormFull />;
}

return <NoConsentAlternative />;
```

Replace with:
```tsx
if (!isHydrated) {
  return null;
}

if (hasConsented === true) {
  return <ContactFormFull />;
}

return <NoConsentAlternative />;
```

This changes three behaviors:
1. **Before hydration (`!isHydrated`):** Returns null instead of rendering ContactFormFull. This prevents a flash of the form before consent state is known. The contact page already conditionally mounts GoogleReCaptchaProvider using the same `isHydrated && hasConsented === true` check, so returning null here is consistent.
2. **Undecided state (`hasConsented === null`):** Now falls through to NoConsentAlternative instead of showing the form. This is the actual bug fix.
3. **Accepted state (`hasConsented === true`):** Shows ContactFormFull (unchanged behavior).
4. **Rejected state (`hasConsented === false`):** Shows NoConsentAlternative (unchanged behavior).

Do NOT modify any other part of the file. The ContactFormFull and NoConsentAlternative components remain unchanged.
  </action>
  <verify>
1. Run `npm run lint` — no errors
2. Run `npm run build` — builds successfully
3. Verify the fix by reading the file and confirming:
   - `hasConsented === true` is the only condition that renders ContactFormFull
   - `!isHydrated` returns null
   - All other states (null, false) render NoConsentAlternative
  </verify>
  <done>
ContactForm only renders the full form when hasConsented is strictly true. Both null (undecided) and false (rejected) states show NoConsentAlternative. Pre-hydration returns null.
  </done>
</task>

</tasks>

<verification>
1. `npm run lint` passes with no errors
2. `npm run build` completes successfully
3. ContactForm.tsx contains `hasConsented === true` as the sole condition for rendering ContactFormFull
4. No `hasConsented !== false` pattern remains in the file
</verification>

<success_criteria>
- ContactForm renders ContactFormFull ONLY when hasConsented === true
- ContactForm renders NoConsentAlternative when hasConsented is null OR false
- ContactForm renders null before hydration completes
- UAT test 4 gap is closed: form is blocked when consent is undecided
</success_criteria>

<output>
After completion, create `.planning/phases/03-script-blocking-form-gating/03-02-SUMMARY.md`
</output>
